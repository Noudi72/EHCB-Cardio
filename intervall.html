<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EHCB Intervall Tabata</title>
  <style>
    body {
      background: #1e1e1e;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 {
      font-size: 2.1rem;
      margin-top: 1.2rem;
      color: #FFD700;
      letter-spacing: 1px;
    }
    .desc {
      margin-bottom: 1.1rem;
      color: #ccc;
      font-size: 1.1rem;
      min-height: 32px;
    }
    .tile {
      border-radius: 20px;
      margin: 0.8rem auto;
      width: 90vw;
      max-width: 375px;
      min-height: 80px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 2.2rem;
      font-weight: bold;
      box-shadow: 0 0 12px rgba(0,0,0,0.18);
      padding: 0.3em 1.2em;
      letter-spacing: 2px;
      opacity: 0.6;
      filter: grayscale(0.25);
      transition: opacity 0.3s ease, filter 0.3s ease;
    }
    .tile.active {
      opacity: 1;
      filter: none;
    }
    .tile span {
      flex: 1;
      text-align: left;
    }
    .tile .time {
      flex: 0 0 95px;
      text-align: right;
      font-size: 2.4rem;
    }
    .prepare { background: #FFD700; color: #222;}
    .work { background: #00c040; color: #fff;}
    .rest { background: #c80000; color: #fff;}
    .setpause { background: #FFD700; color: #222;}
    .row {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1.1rem;
      margin-bottom: 1.1rem;
    }
    .cycles, .tabatas {
      background: #fff;
      color: #111;
      border-radius: 12px;
      width: 100px;
      height: 60px;
      font-size: 1.6rem;
      font-weight: bold;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    .label {
      font-size: 1rem;
      font-weight: normal;
      color: #222;
      margin-top: 2px;
    }
    .button-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1em;
      margin-bottom: 1em;
    }
    .start-btn, .settings-btn, .pause-btn, .reset-btn {
      background: #d50000;
      color: #fff;
      font-size: 1.1rem;
      border: none;
      border-radius: 10px;
      padding: 0.6em 1.3em;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.13);
      margin: 0.5em 0;
    }
    .pause-btn { background: #FFA500; color: #222;}
    .reset-btn { background: #222; color: #fff;}
    .settings-btn { background: #222; }
    /* Modal Styles für Settings */
    .modal {
      display: none;
      position: fixed;
      z-index: 1111;
      left: 0; top: 0; width: 100vw; height: 100vh;
      background: rgba(30,30,30,0.93);
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: #1e1e1e;
      color: #fff;
      border-radius: 16px;
      max-width: 400px;
      width: 96vw;
      max-height: 90vh;
      overflow-y: auto;
      margin: 0 auto;
      box-shadow: 0 8px 24px #000a;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: stretch;
      padding-bottom: 2.5em;
    }
    .modal-content label { display:block; margin: 0.6em 0 0.15em 0; }
    .modal-content input,
    .modal-content textarea {
      width: 95%; max-width: 360px;
      font-size: 1.05em; text-align: left;
      border-radius: 6px; border: 1px solid #888; margin-bottom: 0.5em;
      padding: 0.2em 0.4em;
      font-family: Arial, sans-serif;
    }
    .modal-content .modal-buttons {
      display: flex;
      position: sticky;
      bottom: 0; left: 0;
      background: #1e1e1e;
      gap: 1em;
      justify-content: center;
      padding: 0.8em 0 0.5em 0;
    }
    @media (max-width: 420px) {
      .tile { font-size: 1.1rem; }
      .tile .time { font-size: 1.1rem; }
      .cycles, .tabatas { width: 70px; height: 40px; font-size: 0.8rem;}
    }
  </style>
</head>
<body>
  <h1>Intervall Tabata</h1>
  <div class="desc" id="descText">4 Sets – 6× 30s Work / 15s Rest<br>(Warm-Up &amp; Cooldown by your own)</div>
  <!-- Timer Tiles -->
  <div class="tile prepare" id="tilePrepare"><span>PREPARE</span><span class="time" id="prepareTime">03</span></div>
  <div class="tile work" id="tileWork"><span>WORK</span><span class="time" id="workTime">30</span></div>
  <div class="tile rest" id="tileRest"><span>REST</span><span class="time" id="restTime">15</span></div>
  <div class="tile setpause" id="tileSetPause"><span>SET PAUSE</span><span class="time" id="setPauseTime">120</span></div>
  <div class="row">
    <div class="cycles"><span id="cyclesVal">6</span><span class="label">CYCLES</span></div>
    <div class="tabatas"><span id="tabatasVal">4</span><span class="label">TABATAS</span></div>
  </div>
  <div class="button-row">
    <button class="start-btn" onclick="startTabata()" id="startBtn">▶ Start</button>
    <button class="pause-btn" onclick="pauseTabata()" id="pauseBtn" style="display:none;">Pause</button>
    <button class="reset-btn" onclick="resetTabata()" id="resetBtn" style="display:none;">Reset</button>
  </div>
  <button class="settings-btn" onclick="openSettings()">⚙️ Einstellungen</button>
  <!-- SETTINGS MODAL -->
  <div class="modal" id="settingsModal">
    <form class="modal-content" onsubmit="saveSettings();return false;">
      <label>Beschreibung (optional):<br>
        <textarea id="descTextarea" rows="2"></textarea>
      </label>
      <label>Prepare (sec): <input id="setPrepare" type="number" min="0" max="99" value="3"></label>
      <label>Work (sec): <input id="setWork" type="number" min="1" max="999" value="30"></label>
      <label>Rest (sec): <input id="setRest" type="number" min="1" max="999" value="15"></label>
      <label>Set Pause (sec): <input id="setSetPause" type="number" min="1" max="999" value="120"></label>
      <label>Cycles: <input id="setCycles" type="number" min="1" max="99" value="6"></label>
      <label>Tabatas: <input id="setTabatas" type="number" min="1" max="99" value="4"></label>
      <div class="modal-buttons">
        <button type="submit">✓ Übernehmen</button>
        <button type="button" onclick="closeSettings()">✗ Schließen</button>
      </div>
    </form>
  </div>
  <!-- AUDIO -->
  <audio id="soundGo" src="3-2-1-Go.mp3"></audio>
  <audio id="soundRest" src="rest_2.mp3"></audio>
  <audio id="soundBeep" src="3s beep.wav"></audio>
  <script>
    let timer = null;
    let isPaused = false;
    let phases = [];
    let current = 0;
    let cycles = 6, tabatas = 4, prepare = 3, work = 30, rest = 15, setPause = 120;
    let curCycle = 6, curTabata = 4;
    let started = false;

    // Description editing
    const descText = document.getElementById('descText');
    const descTextarea = document.getElementById('descTextarea');
    // Load description from localStorage if available
    window.addEventListener('load', () => {
      const savedDesc = localStorage.getItem('tabataDescription');
      if(savedDesc) {
        descText.innerHTML = savedDesc.replace(/\n/g, '<br>');
        descTextarea.value = savedDesc.replace(/<br\s*\/?>/gi, '\n');
      }
    });

    function openSettings() {
      document.getElementById('settingsModal').style.display = 'flex';
      descTextarea.value = descText.innerHTML.replace(/<br\s*\/?>/gi, '\n');
      document.getElementById('setPrepare').value = prepare;
      document.getElementById('setWork').value = work;
      document.getElementById('setRest').value = rest;
      document.getElementById('setSetPause').value = setPause;
      document.getElementById('setCycles').value = cycles;
      document.getElementById('setTabatas').value = tabatas;
    }
    function closeSettings() {
      document.getElementById('settingsModal').style.display = 'none';
    }
    function saveSettings() {
      let val = descTextarea.value.trim();
      if(val === '') val = '4 Sets – 6× 30s Work / 15s Rest (Warm-Up & Cooldown by your own)';
      descText.innerHTML = val.replace(/\n/g, '<br>');
      localStorage.setItem('tabataDescription', descText.innerHTML);
      prepare = parseInt(document.getElementById('setPrepare').value);
      work = parseInt(document.getElementById('setWork').value);
      rest = parseInt(document.getElementById('setRest').value);
      setPause = parseInt(document.getElementById('setSetPause').value);
      cycles = parseInt(document.getElementById('setCycles').value);
      tabatas = parseInt(document.getElementById('setTabatas').value);
      document.getElementById('prepareTime').textContent = prepare < 10 ? '0'+prepare : prepare;
      document.getElementById('workTime').textContent = work;
      document.getElementById('restTime').textContent = rest;
      document.getElementById('setPauseTime').textContent = setPause;
      curCycle = cycles;
      curTabata = tabatas;
      document.getElementById('cyclesVal').textContent = curCycle;
      document.getElementById('tabatasVal').textContent = curTabata;
      closeSettings();
    }
    function updateCounts(){
      document.getElementById('cyclesVal').textContent = curCycle >= 0 ? curCycle : 0;
      document.getElementById('tabatasVal').textContent = curTabata >= 0 ? curTabata : 0;
    }
    function showPhase(type, value){
      // Set all tiles to inactive style and default times
      const prepareTile = document.getElementById('tilePrepare');
      const workTile = document.getElementById('tileWork');
      const restTile = document.getElementById('tileRest');
      const setPauseTile = document.getElementById('tileSetPause');

      // Remove active class from all
      prepareTile.classList.remove('active');
      workTile.classList.remove('active');
      restTile.classList.remove('active');
      setPauseTile.classList.remove('active');

      // Set default times
      document.getElementById('prepareTime').textContent = prepare < 10 ? '0'+prepare : prepare;
      document.getElementById('workTime').textContent = work;
      document.getElementById('restTime').textContent = rest;
      document.getElementById('setPauseTime').textContent = setPause;

      // Set active tile opacity and time
      if(type==='PREPARE') {
        prepareTile.classList.add('active');
        document.getElementById('prepareTime').textContent = value < 10 ? '0'+value : value;
      } else if(type==='WORK') {
        workTile.classList.add('active');
        document.getElementById('workTime').textContent = value;
      } else if(type==='REST') {
        restTile.classList.add('active');
        document.getElementById('restTime').textContent = value;
      } else if(type==='SET PAUSE') {
        setPauseTile.classList.add('active');
        document.getElementById('setPauseTime').textContent = value;
      }
    }
    function startTabata() {
      started = true;
      isPaused = false;
      document.getElementById('startBtn').disabled = true;
      document.getElementById('pauseBtn').style.display = '';
      document.getElementById('resetBtn').style.display = '';
      curCycle = cycles;
      curTabata = tabatas;
      updateCounts();
      // Build phases (no REST after last WORK)
      phases = [];
      if (prepare > 0) phases.push({type:'PREPARE', duration:prepare});
      for(let t=1; t<=tabatas; t++){
        for(let c=1; c<=cycles; c++){
          phases.push({type:'WORK', duration:work});
          if(c < cycles) phases.push({type:'REST', duration:rest});
        }
        if(t<tabatas) phases.push({type:'SET PAUSE', duration:setPause});
      }
      current = 0;
      nextPhase();
    }
    function playGo() {
  let audio = document.getElementById('soundGo');
  audio.pause();
  audio.currentTime = 0;
  audio.play();
}
function playRest() {
  let audio = document.getElementById('soundRest');
  audio.pause();
  audio.currentTime = 0;
  audio.play();
}
function playBeep() {
  let audio = document.getElementById('soundBeep');
  audio.pause();
  audio.currentTime = 0;
  audio.play();
}
    function nextPhase(){
      if (current>=phases.length) {
        showPhase('', 0);
        document.getElementById('startBtn').disabled = false;
        document.getElementById('pauseBtn').style.display = 'none';
        document.getElementById('resetBtn').style.display = 'none';
        started = false;
        return;
      }
      let phase = phases[current];
      let t = phase.duration;
      showPhase(phase.type, t);
      timer = setInterval(()=>{
        showPhase(phase.type, t);
        // Prepare/Set Pause: play 3-2-1-Go in last 4...1 seconds
        if((phase.type==='PREPARE'||phase.type==='SET PAUSE') && (t==4||t==3||t==2||t==1)) playGo();
        if((phase.type==='WORK'||phase.type==='REST') && t<=3 && t>0) playBeep();
        if(t==0 && phase.type==='WORK') playRest();
        if(t==0 && phase.type==='REST') playRest();
        t--;
        if (t<0) {
          clearInterval(timer);
          // Down-count cycles/tabatas
          if(phase.type==='WORK'){
            if(curCycle > 1) curCycle--;
            else if(curCycle === 1) curCycle = 0;
          }
          if(phase.type==='SET PAUSE') {
            if(curTabata > 1) curTabata--;
            else if(curTabata === 1) curTabata = 0;
            curCycle = cycles;
          }
          updateCounts();
          current++;
          if(!isPaused) nextPhase();
        }
      },1000);
    }
    function pauseTabata() {
      if (!started) return;
      if (!isPaused) {
        clearInterval(timer);
        isPaused = true;
        document.getElementById('pauseBtn').textContent = 'Fortsetzen';
      } else {
        isPaused = false;
        document.getElementById('pauseBtn').textContent = 'Pause';
        nextPhase();
      }
    }
    function resetTabata() {
      clearInterval(timer);
      isPaused = false;
      started = false;
      document.getElementById('pauseBtn').textContent = 'Pause';
      document.getElementById('pauseBtn').style.display = 'none';
      document.getElementById('resetBtn').style.display = 'none';
      document.getElementById('startBtn').disabled = false;
      showPhase('PREPARE', prepare < 10 ? '0'+prepare : prepare);
      document.getElementById('workTime').textContent = work;
      document.getElementById('restTime').textContent = rest;
      document.getElementById('setPauseTime').textContent = setPause;
      curCycle = cycles;
      curTabata = tabatas;
      updateCounts();
    }
  </script>
</body>
</html>