<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Regeneration ‚Äì EHCB Cardio</title>
  <link rel="manifest" href="manifest.json" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #191919;
      color: #eee;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
    }
    header {
      text-align: center;
      margin-bottom: 10px;
    }
    header img.logo {
      width: 100px;
      height: auto;
      margin: 0 auto 10px auto;
      display: block;
    }
    header h1 {
      margin: 0;
      font-weight: normal;
      font-size: 2em;
      color: #4caf50;
    }
    #description {
      text-align: center;
      font-size: 1.1em;
      margin-bottom: 20px;
      max-width: 400px;
      color: #ccc;
    }
    #timer-container {
      background: linear-gradient(135deg, #4caf50, #087f23);
      border-radius: 15px;
      padding: 20px 40px;
      margin-bottom: 20px;
      width: 320px;
      box-shadow: 0 0 15px #4caf50aa;
      display: flex;
      flex-direction: column;
      align-items: center;
      user-select: none;
    }
    #currentPhase {
      font-size: 1.3em;
      margin-bottom: 10px;
      font-weight: bold;
      color: #d0f0c0;
      text-align: center;
    }
    #timer {
      font-size: 5em;
      font-weight: bold;
      color: #fff;
      letter-spacing: 3px;
    }
    #controls {
      margin-bottom: 20px;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: center;
      width: 100%;
      max-width: 400px;
    }
    button {
      background-color: #4caf50;
      border: none;
      color: white;
      padding: 12px 25px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 1em;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      user-select: none;
      min-width: 110px;
    }
    button:hover {
      background-color: #087f23;
    }
    table {
      width: 100%;
      max-width: 900px;
      border-collapse: collapse;
      background-color: #222;
      color: #ddd;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 0 10px #000;
      user-select: none;
    }
    thead {
      background-color: #4caf50;
      color: white;
    }
    th, td {
      padding: 12px 15px;
      text-align: center;
      border-bottom: 1px solid #333;
    }
    tbody tr:nth-child(even) {
      background-color: #2a2a2a;
    }
    tbody tr:hover {
      background-color: #3a3a3a;
    }
    td[contenteditable="true"] {
      background-color: #333;
      border-radius: 4px;
      outline: none;
      cursor: text;
      color: #ddd;
    }
    td[contenteditable="true"]:focus {
      background-color: #4caf50;
      color: #191919;
      font-weight: bold;
    }
    td button {
      background: transparent;
      border: none;
      color: #ff5555;
      font-size: 1.2em;
      cursor: pointer;
      user-select: none;
      padding: 0;
    }
    td button:hover {
      color: #ff0000;
    }
    #addPhaseBtn {
      background-color: #087f23;
      margin-top: 10px;
      width: 100%;
      max-width: 900px;
      border-radius: 8px;
      font-weight: bold;
      user-select: none;
    }
    @media (max-width: 600px) {
      table, thead, tbody, th, td, tr {
        font-size: 0.98em !important;
        padding: 6px 4px !important;
      }
      th, td {
        word-break: break-word !important;
        white-space: normal !important;
        font-size: 0.98em !important;
      }
      table {
        display: block;
        overflow-x: auto;
        width: 100vw;
        min-width: 420px;
        max-width: none;
      }
    }
    td {
      word-break: break-word;
      white-space: normal;
    }
  </style>
</head>
<body>
  <header>
    <img src="icon-cardio.png" alt="Cardio Logo" class="logo" />
    <h1>Regeneration ‚Äì EHCB Cardio</h1>
  </header>
  <div id="description">
    Ziel: Durchblutung f√∂rdern, Laktatabbau ‚Äì Fokus: Niedrige Intensit√§t, gleichm√§√üige Kadenz
  </div>
  <div id="timer-container" aria-live="polite" aria-atomic="true">
    <div id="currentPhase">Bereit</div>
    <div id="timer">00:00</div>
  </div>
  <div id="controls">
    <button id="startBtn" aria-label="Start Timer">Start</button>
    <button id="resetBtn" aria-label="Reset Timer">Reset</button>
    <button id="editBtn" aria-label="Bearbeitungsmodus Ein/Aus">Bearbeiten</button>
  </div>
  <table aria-label="Phasen Tabelle">
    <thead>
      <tr>
        <th>Phase</th>
        <th>Dauer (s)</th>
        <th>Beschreibung</th>
        <th>RPM</th>
        <th>HF%</th>
        <th>Aktion</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
  <button id="addPhaseBtn" style="display:none;">‚ûï Phase hinzuf√ºgen</button>

  <script>
    let phases = [
      { name: "Aufw√§rmen", duration: 600, rpm: "90", hf: "50-60", desc: "10 Min. Sitzend bei leichtem Widerstand" },
      { name: "Phase 1", duration: 300, rpm: "70", hf: "70-75", desc: "5 Min. bei mittlerem Widerstand" },
      { name: "Phase 2", duration: 120, rpm: "60", hf: "50-60", desc: "2 Min. locker" },
      { name: "Phase 1", duration: 300, rpm: "70", hf: "70-75", desc: "5 Min. bei mittlerem Widerstand" },
      { name: "Phase 2", duration: 120, rpm: "60", hf: "50-60", desc: "2 Min. locker" },
      { name: "Phase 1", duration: 300, rpm: "70", hf: "70-75", desc: "5 Min. bei mittlerem Widerstand" },
      { name: "Phase 2", duration: 120, rpm: "60", hf: "50-60", desc: "2 Min. locker" },
      { name: "Cool-Down", duration: 300, rpm: "60", hf: "50-60", desc: "5 Min. Locker fahren, niedriger Widerstand" }
    ];

    const tableBody = document.getElementById("tableBody");
    const timerEl = document.getElementById("timer");
    const currentPhaseEl = document.getElementById("currentPhase");
    const startBtn = document.getElementById("startBtn");
    const resetBtn = document.getElementById("resetBtn");
    const editBtn = document.getElementById("editBtn");
    const addPhaseBtn = document.getElementById("addPhaseBtn");

    let timerInterval = null;
    let currentPhaseIndex = 0;
    let timeLeft = 0;
    let isRunning = false;
    let isEditing = false;

    function formatTime(seconds) {
      const m = Math.floor(seconds / 60).toString().padStart(2, "0");
      const s = (seconds % 60).toString().padStart(2, "0");
      return `${m}:${s}`;
    }

    function renderTable() {
      tableBody.innerHTML = "";
      phases.forEach((p, i) => {
        const row = document.createElement("tr");
        if (isEditing) {
          row.innerHTML = `
            <td contenteditable="true" data-field="name">${p.name}</td>
            <td contenteditable="true" data-field="duration">${p.duration}</td>
            <td contenteditable="true" data-field="desc">${p.desc}</td>
            <td contenteditable="true" data-field="rpm">${p.rpm}</td>
            <td contenteditable="true" data-field="hf">${p.hf}</td>
            <td><button aria-label="Phase l√∂schen" data-index="${i}">üóëÔ∏è</button></td>
          `;
        } else {
          row.innerHTML = `
            <td>${p.name}</td>
            <td>${p.duration}</td>
            <td>${p.desc}</td>
            <td>${p.rpm}</td>
            <td>${p.hf}</td>
            <td></td>
          `;
        }
        tableBody.appendChild(row);
      });

      if (isEditing) {
        addPhaseBtn.style.display = "block";
      } else {
        addPhaseBtn.style.display = "none";
      }
    }

    function updatePhaseFromRow(row, index) {
      const cells = row.querySelectorAll("td[contenteditable='true']");
      if (cells.length === 5) {
        let name = cells[0].innerText.trim();
        let duration = parseInt(cells[1].innerText.trim());
        if (isNaN(duration) || duration < 1) duration = 1;
        let desc = cells[2].innerText.trim();
        let rpm = cells[3].innerText.trim();
        let hf = cells[4].innerText.trim();
        phases[index] = { name, duration, desc, rpm, hf };
      }
    }

    function saveTableEdits() {
      const rows = tableBody.querySelectorAll("tr");
      rows.forEach((row, i) => {
        updatePhaseFromRow(row, i);
      });
    }

    function startTimer() {
      if (isRunning) return;
      if (phases.length === 0) return;
      isRunning = true;
      startBtn.disabled = true;
      resetBtn.disabled = false;
      editBtn.disabled = true;
      currentPhaseIndex = 0;
      timeLeft = phases[0].duration;
      updateTimerDisplay();
      timerInterval = setInterval(() => {
        timeLeft--;
        if (timeLeft < 0) {
          currentPhaseIndex++;
          if (currentPhaseIndex >= phases.length) {
            stopTimer(true);
            return;
          } else {
            timeLeft = phases[currentPhaseIndex].duration;
          }
        }
        updateTimerDisplay();
      }, 1000);
    }

    function stopTimer(finished = false) {
      isRunning = false;
      clearInterval(timerInterval);
      timerInterval = null;
      startBtn.disabled = false;
      resetBtn.disabled = false;
      editBtn.disabled = false;
      if (finished) {
        currentPhaseEl.textContent = "Fertig!";
        timerEl.textContent = "00:00";
      }
    }

    function resetTimer() {
      stopTimer();
      currentPhaseIndex = 0;
      timeLeft = phases.length > 0 ? phases[0].duration : 0;
      currentPhaseEl.textContent = "Bereit";
      timerEl.textContent = formatTime(timeLeft);
    }

    function updateTimerDisplay() {
      if (currentPhaseIndex < phases.length) {
        const phase = phases[currentPhaseIndex];
        currentPhaseEl.textContent = phase.name;
        timerEl.textContent = formatTime(timeLeft);
      } else {
        currentPhaseEl.textContent = "Fertig!";
        timerEl.textContent = "00:00";
      }
    }

    function toggleEditMode() {
      if (isRunning) return;
      if (isEditing) {
        // Save edits
        saveTableEdits();
        isEditing = false;
        editBtn.textContent = "Bearbeiten";
        addPhaseBtn.style.display = "none";
      } else {
        isEditing = true;
        editBtn.textContent = "Speichern";
        addPhaseBtn.style.display = "block";
      }
      renderTable();
    }

    function deletePhase(index) {
      if (index >= 0 && index < phases.length) {
        phases.splice(index, 1);
        renderTable();
      }
    }

    function addPhase() {
      phases.push({ name: "Neu", duration: 60, desc: "Beschreibung", rpm: "", hf: "" });
      renderTable();
    }

    // Initial render
    resetTimer();
    renderTable();

    startBtn.addEventListener("click", () => {
      startTimer();
    });

    resetBtn.addEventListener("click", () => {
      resetTimer();
    });

    editBtn.addEventListener("click", () => {
      toggleEditMode();
    });

    addPhaseBtn.addEventListener("click", () => {
      addPhase();
    });

    tableBody.addEventListener("click", (e) => {
      if (!isEditing) return;
      if (e.target.tagName === "BUTTON" && e.target.dataset.index !== undefined) {
        const idx = parseInt(e.target.dataset.index);
        deletePhase(idx);
      }
    });

    // Accessibility: prevent line breaks in contenteditable cells on Enter
    tableBody.addEventListener("keydown", (e) => {
      if (e.target.getAttribute("contenteditable") === "true" && e.key === "Enter") {
        e.preventDefault();
        e.target.blur();
      }
    });
  </script>
</body>
</html>