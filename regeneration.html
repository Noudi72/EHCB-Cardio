<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cardio Intervall - Regeneration</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #000;
    color: #ff0;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }
  #logo {
    margin: 1rem 0 0.5rem 0;
    max-width: 250px;
    width: 80vw;
    height: auto;
    user-select: none;
  }
  #backButton {
    background-color: #e23a3a;
    border: none;
    color: white;
    padding: 0.75rem 1.5rem;
    margin: 0.5rem auto 1rem auto;
    font-size: 1rem;
    border-radius: 5px;
    cursor: pointer;
    box-shadow: 0 3px 6px rgba(226,58,58,0.5);
    transition: background-color 0.3s ease;
    display: block;
    max-width: 600px;
    width: 90vw;
    text-align: center;
  }
  #backButton:hover {
    background-color: #b32b2b;
  }
  .phaseBox {
    background: #ff0;
    color: #000;
    max-width: 600px;
    width: 90vw;
    border-radius: 15px;
    padding: 2rem 2rem 2.5rem 2rem;
    box-shadow: 0 8px 15px rgba(255, 255, 0, 0.6);
    text-align: center;
    user-select: none;
    margin-bottom: 1rem;
  }
  .phaseLabel {
    font-size: 3rem;
    font-weight: 900;
    margin-bottom: 0.5rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
  }
  #phaseDesc {
    font-size: 1.8rem;
    font-weight: 600;
    margin-bottom: 1rem;
    letter-spacing: 0.06em;
  }
  #timer {
    font-size: 7rem;
    font-weight: 900;
    letter-spacing: 0.15em;
    margin-bottom: 1rem;
  }
  #phaseInfo {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    letter-spacing: 0.05em;
  }
  #phaseCount {
    font-size: 1.3rem;
    font-weight: 600;
    letter-spacing: 0.05em;
  }
  .buttons {
    max-width: 600px;
    width: 90vw;
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }
  button {
    background-color: #ff0;
    border: none;
    color: #000;
    padding: 1rem 2rem;
    font-size: 1.5rem;
    font-weight: 700;
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 5px 12px rgba(255, 255, 0, 0.7);
    transition: background-color 0.3s ease, color 0.3s ease;
    flex: 1;
    user-select: none;
  }
  button:hover:not(:disabled) {
    background-color: #e6e600;
    color: #111;
  }
  button:disabled {
    background-color: #999900;
    color: #444;
    cursor: default;
    box-shadow: none;
  }
  #editTableContainer {
    max-width: 600px;
    width: 90vw;
    overflow-x: auto;
    margin-bottom: 2rem;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 1.2rem;
    color: #000;
    background: #ff0;
    border-radius: 10px;
    overflow: hidden;
  }
  th, td {
    border: 1px solid #ccc200;
    padding: 0.75rem 0.5rem;
    text-align: center;
  }
  th {
    background-color: #d4d400;
    font-weight: 800;
    letter-spacing: 0.05em;
  }
  input[type="number"], input[type="text"] {
    width: 100%;
    box-sizing: border-box;
    padding: 0.4rem;
    font-size: 1.2rem;
    border: 1px solid #999900;
    border-radius: 5px;
    text-align: center;
    font-weight: 600;
    color: #000;
    background: #ffff66;
    user-select: text;
  }
  input[type="number"]::-webkit-inner-spin-button, 
  input[type="number"]::-webkit-outer-spin-button { 
    -webkit-appearance: none; 
    margin: 0; 
  }
  @media (max-width: 640px) {
    .phaseBox {
      padding: 1.5rem 1.5rem 2rem 1.5rem;
    }
    .phaseLabel {
      font-size: 2.5rem;
    }
    #phaseDesc {
      font-size: 1.5rem;
    }
    #timer {
      font-size: 5rem;
    }
    #phaseInfo {
      font-size: 1.3rem;
    }
    #phaseCount {
      font-size: 1.1rem;
    }
    button {
      font-size: 1.2rem;
      padding: 0.75rem 1rem;
    }
    #backButton {
      font-size: 1.2rem;
      padding: 0.75rem 1rem;
      max-width: 90vw;
    }
    table {
      font-size: 1rem;
    }
    input[type="number"], input[type="text"] {
      font-size: 1rem;
      padding: 0.3rem;
    }
  }
</style>
</head>
<body>
<img id="logo" src="EHCB_Logo.svg" alt="EHCB Logo" draggable="false" />
<button id="backButton" type="button" onclick="history.back()">Zur체ck</button>

<div class="phaseBox" role="region" aria-live="polite" aria-atomic="true">
  <div class="phaseLabel" id="phaseLabel">Get Ready</div>
  <div id="phaseDesc">Bereite dich vor</div>
  <div id="timer" aria-label="Timer">00:30</div>
  <div id="phaseInfo"></div>
  <div id="phaseCount"></div>
</div>

<div class="buttons">
  <button id="startBtn">Start</button>
  <button id="editBtn">Bearbeiten</button>
  <button id="resetBtn" disabled>Reset</button>
</div>

<div id="editTableContainer" hidden>
  <table id="intervalTable" aria-label="Intervall Bearbeitungstabelle">
    <thead>
      <tr>
        <th>Phase</th>
        <th>Dauer (Sek.)</th>
        <th>Beschreibung</th>
      </tr>
    </thead>
    <tbody>
      <!-- Dynamisch gef체llt -->
    </tbody>
  </table>
</div>

<audio id="startSound" preload="auto" src="start.mp3"></audio>
<audio id="endSound" preload="auto" src="end.mp3"></audio>

<script>
  // Regenerationsphasen ohne Warm-Up, erste Phase "Get Ready" 30s
  // Phasen: Get Ready 30s, danach locker/erholt/locker/erholt/abwechselnd/cooldown je 300s
  const phases = [
    {name: 'Get Ready', duration: 30, desc: 'Bereite dich vor'},
    {name: 'Locker', duration: 300, desc: 'Locker fahren'},
    {name: 'Erholt', duration: 300, desc: 'Erholt fahren'},
    {name: 'Locker', duration: 300, desc: 'Locker fahren'},
    {name: 'Erholt', duration: 300, desc: 'Erholt fahren'},
    {name: 'Abwechselnd', duration: 300, desc: 'Abwechselnd fahren'},
    {name: 'Cooldown', duration: 300, desc: 'Abk체hlen'}
  ];

  let currentPhaseIndex = 0;
  let remainingTime = phases[0].duration;
  let timerInterval = null;
  let isRunning = false;
  let editMode = false;

  const phaseLabel = document.getElementById('phaseLabel');
  const phaseDesc = document.getElementById('phaseDesc');
  const timerDisplay = document.getElementById('timer');
  const phaseInfo = document.getElementById('phaseInfo');
  const phaseCount = document.getElementById('phaseCount');
  const startBtn = document.getElementById('startBtn');
  const editBtn = document.getElementById('editBtn');
  const resetBtn = document.getElementById('resetBtn');
  const editTableContainer = document.getElementById('editTableContainer');
  const intervalTableBody = document.querySelector('#intervalTable tbody');
  const startSound = document.getElementById('startSound');
  const endSound = document.getElementById('endSound');

  function formatTime(seconds) {
    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    return (m < 10 ? '0' : '') + m + ':' + (s < 10 ? '0' : '') + s;
  }

  function updateDisplay() {
    const phase = phases[currentPhaseIndex];
    phaseLabel.textContent = phase.name;
    phaseDesc.textContent = phase.desc;
    timerDisplay.textContent = formatTime(remainingTime);
    phaseCount.textContent = `Phase ${currentPhaseIndex + 1} von ${phases.length}`;
    if (isRunning) {
      phaseInfo.textContent = 'L채uft...';
    } else {
      phaseInfo.textContent = 'Gestoppt';
    }
  }

  function nextPhase() {
    currentPhaseIndex++;
    if (currentPhaseIndex >= phases.length) {
      clearInterval(timerInterval);
      isRunning = false;
      updateDisplay();
      startBtn.disabled = false;
      resetBtn.disabled = false;
      phaseInfo.textContent = 'Fertig!';
      endSound.play();
      return;
    }
    remainingTime = phases[currentPhaseIndex].duration;
    updateDisplay();
    if(currentPhaseIndex === 1) {
      // Startschuss nach Get Ready
      startSound.play();
    }
  }

  function timerTick() {
    if (remainingTime > 0) {
      remainingTime--;
      updateDisplay();
    } else {
      nextPhase();
    }
  }

  function startTimer() {
    if (isRunning) return;
    isRunning = true;
    startBtn.disabled = true;
    resetBtn.disabled = false;
    editBtn.disabled = true;
    timerInterval = setInterval(timerTick, 1000);
    updateDisplay();
  }

  function resetTimer() {
    clearInterval(timerInterval);
    isRunning = false;
    currentPhaseIndex = 0;
    remainingTime = phases[0].duration;
    startBtn.disabled = false;
    resetBtn.disabled = true;
    editBtn.disabled = false;
    updateDisplay();
  }

  function toggleEdit() {
    if (editMode) {
      // Save edits
      const rows = intervalTableBody.querySelectorAll('tr');
      const newPhases = [];
      for (const row of rows) {
        const name = row.querySelector('input[name="name"]').value.trim() || 'Phase';
        let duration = parseInt(row.querySelector('input[name="duration"]').value);
        if (isNaN(duration) || duration < 1) duration = 30;
        const desc = row.querySelector('input[name="desc"]').value.trim() || '';
        newPhases.push({name, duration, desc});
      }
      if(newPhases.length === 0) {
        alert('Bitte mindestens eine Phase definieren.');
        return;
      }
      phases.length = 0;
      phases.push(...newPhases);
      resetTimer();
      editTableContainer.hidden = true;
      editBtn.textContent = 'Bearbeiten';
      editMode = false;
    } else {
      // Enter edit mode
      editTableContainer.hidden = false;
      intervalTableBody.innerHTML = '';
      phases.forEach((p, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input type="text" name="name" value="${p.name}" aria-label="Name der Phase ${i+1}"></td>
          <td><input type="number" name="duration" min="1" value="${p.duration}" aria-label="Dauer der Phase ${i+1} in Sekunden"></td>
          <td><input type="text" name="desc" value="${p.desc}" aria-label="Beschreibung der Phase ${i+1}"></td>
        `;
        intervalTableBody.appendChild(tr);
      });
      editBtn.textContent = 'Speichern';
      editMode = true;
    }
  }

  startBtn.addEventListener('click', startTimer);
  resetBtn.addEventListener('click', resetTimer);
  editBtn.addEventListener('click', () => {
    if(isRunning) {
      alert('Bitte stoppen Sie den Timer, bevor Sie bearbeiten.');
      return;
    }
    toggleEdit();
  });

  // Initial display
  updateDisplay();

</script>
</body>
</html>
