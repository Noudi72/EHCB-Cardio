<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cardio Intervall - Regeneration</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #fff;
    color: #333;
  }
  h1 {
    text-align: center;
    margin: 1rem 0;
    font-size: 2rem;
  }
  .phaseBox {
    max-width: 600px;
    margin: 1rem auto;
    background: #f9f9f9;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    border-radius: 10px;
    padding: 1rem 2rem;
    text-align: center;
  }
  .phaseLabel {
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
    color: #2a7ae2;
  }
  #phaseDesc {
    font-size: 1.2rem;
    margin: 0.5rem 0 1rem 0;
  }
  #timer {
    font-size: 4rem;
    font-weight: bold;
    color: #e23a3a;
    margin-bottom: 1rem;
    letter-spacing: 0.1em;
  }
  #phaseInfo {
    font-size: 1rem;
    margin-bottom: 1rem;
    color: #555;
  }
  #phaseCount {
    font-size: 1rem;
    color: #777;
  }
  .buttons {
    max-width: 600px;
    margin: 1rem auto;
    text-align: center;
  }
  button {
    background-color: #2a7ae2;
    border: none;
    color: white;
    padding: 0.75rem 1.5rem;
    margin: 0 0.5rem 0.5rem 0.5rem;
    font-size: 1rem;
    border-radius: 5px;
    cursor: pointer;
    box-shadow: 0 3px 6px rgba(42,122,226,0.5);
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #1f5bb8;
  }
  button:disabled {
    background-color: #a0a0a0;
    cursor: default;
    box-shadow: none;
  }
  #editTableContainer {
    max-width: 600px;
    margin: 1rem auto 2rem auto;
    overflow-x: auto;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 1rem;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 0.5rem;
    text-align: center;
  }
  th {
    background-color: #2a7ae2;
    color: white;
    font-weight: normal;
  }
  input[type="number"], input[type="text"] {
    width: 100%;
    box-sizing: border-box;
    padding: 0.25rem;
    font-size: 1rem;
    border: 1px solid #ccc;
    border-radius: 3px;
    text-align: center;
  }
  #backButton {
    max-width: 600px;
    margin: 0 auto 2rem auto;
    display: block;
    background-color: #777;
  }
  #backButton:hover {
    background-color: #555;
  }
  @media (max-width: 640px) {
    .phaseBox {
      padding: 1rem;
      margin: 1rem 1rem;
    }
    #timer {
      font-size: 3rem;
    }
    button {
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      margin: 0.25rem 0.25rem 0.5rem 0.25rem;
    }
  }
</style>
</head>
<body>
<h1>Cardio Intervall - Regeneration</h1>

<div class="phaseBox" role="region" aria-live="polite" aria-atomic="true">
  <div class="phaseLabel" id="phaseLabel">Get Ready</div>
  <div id="phaseDesc">Bereite dich vor</div>
  <div id="timer" aria-label="Timer">00:30</div>
  <div id="phaseInfo"></div>
  <div id="phaseCount"></div>
</div>

<div class="buttons">
  <button id="startBtn">Start</button>
  <button id="editBtn">Bearbeiten</button>
  <button id="resetBtn" disabled>Reset</button>
</div>

<div id="editTableContainer" hidden>
  <table id="intervalTable" aria-label="Intervall Bearbeitungstabelle">
    <thead>
      <tr>
        <th>Phase</th>
        <th>Dauer (Sek.)</th>
        <th>Beschreibung</th>
      </tr>
    </thead>
    <tbody>
      <!-- Dynamisch gefüllt -->
    </tbody>
  </table>
</div>

<button id="backButton" type="button" onclick="history.back()">Zurück</button>

<audio id="startSound" preload="auto" src="start.mp3"></audio>
<audio id="endSound" preload="auto" src="end.mp3"></audio>

<script>
  // Phasen-Definitionen für Regeneration (ohne Warm-Up)
  // Erste Phase: Get Ready 30s
  // Danach Regenerationsphasen je 5 Min (300s) mit locker/erholt/abwechselnd, abschließend Cooldown 5 Min.
  // Beispiel: locker - erholt - locker - erholt - abwechselnd - cooldown
  const phases = [
    {name: 'Get Ready', duration: 30, desc: 'Bereite dich vor'},
    {name: 'Locker', duration: 300, desc: 'Locker fahren'},
    {name: 'Erholt', duration: 300, desc: 'Erholt fahren'},
    {name: 'Locker', duration: 300, desc: 'Locker fahren'},
    {name: 'Erholt', duration: 300, desc: 'Erholt fahren'},
    {name: 'Abwechselnd', duration: 300, desc: 'Abwechselnd fahren'},
    {name: 'Cooldown', duration: 300, desc: 'Abkühlen'}
  ];

  let currentPhaseIndex = 0;
  let remainingTime = phases[0].duration;
  let timerInterval = null;
  let isRunning = false;
  let editMode = false;

  const phaseLabel = document.getElementById('phaseLabel');
  const phaseDesc = document.getElementById('phaseDesc');
  const timerDisplay = document.getElementById('timer');
  const phaseInfo = document.getElementById('phaseInfo');
  const phaseCount = document.getElementById('phaseCount');
  const startBtn = document.getElementById('startBtn');
  const editBtn = document.getElementById('editBtn');
  const resetBtn = document.getElementById('resetBtn');
  const editTableContainer = document.getElementById('editTableContainer');
  const intervalTableBody = document.querySelector('#intervalTable tbody');
  const backButton = document.getElementById('backButton');
  const startSound = document.getElementById('startSound');
  const endSound = document.getElementById('endSound');

  function formatTime(seconds) {
    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    return (m < 10 ? '0' : '') + m + ':' + (s < 10 ? '0' : '') + s;
  }

  function updateDisplay() {
    const phase = phases[currentPhaseIndex];
    phaseLabel.textContent = phase.name;
    phaseDesc.textContent = phase.desc;
    timerDisplay.textContent = formatTime(remainingTime);
    phaseCount.textContent = `Phase ${currentPhaseIndex + 1} von ${phases.length}`;
    if (isRunning) {
      phaseInfo.textContent = 'Läuft...';
    } else {
      phaseInfo.textContent = 'Gestoppt';
    }
  }

  function nextPhase() {
    currentPhaseIndex++;
    if (currentPhaseIndex >= phases.length) {
      clearInterval(timerInterval);
      isRunning = false;
      updateDisplay();
      startBtn.disabled = false;
      resetBtn.disabled = false;
      phaseInfo.textContent = 'Fertig!';
      endSound.play();
      return;
    }
    remainingTime = phases[currentPhaseIndex].duration;
    updateDisplay();
    if(currentPhaseIndex === 1) {
      // Startschuss nach Get Ready
      startSound.play();
    }
  }

  function timerTick() {
    if (remainingTime > 0) {
      remainingTime--;
      updateDisplay();
    } else {
      nextPhase();
    }
  }

  function startTimer() {
    if (isRunning) return;
    isRunning = true;
    startBtn.disabled = true;
    resetBtn.disabled = false;
    editBtn.disabled = true;
    timerInterval = setInterval(timerTick, 1000);
    updateDisplay();
  }

  function resetTimer() {
    clearInterval(timerInterval);
    isRunning = false;
    currentPhaseIndex = 0;
    remainingTime = phases[0].duration;
    startBtn.disabled = false;
    resetBtn.disabled = true;
    editBtn.disabled = false;
    updateDisplay();
  }

  function toggleEdit() {
    if (editMode) {
      // Save edits
      const rows = intervalTableBody.querySelectorAll('tr');
      const newPhases = [];
      for (const row of rows) {
        const name = row.querySelector('input[name="name"]').value.trim() || 'Phase';
        let duration = parseInt(row.querySelector('input[name="duration"]').value);
        if (isNaN(duration) || duration < 1) duration = 30;
        const desc = row.querySelector('input[name="desc"]').value.trim() || '';
        newPhases.push({name, duration, desc});
      }
      if(newPhases.length === 0) {
        alert('Bitte mindestens eine Phase definieren.');
        return;
      }
      phases.length = 0;
      phases.push(...newPhases);
      resetTimer();
      editTableContainer.hidden = true;
      editBtn.textContent = 'Bearbeiten';
      editMode = false;
    } else {
      // Enter edit mode
      editTableContainer.hidden = false;
      intervalTableBody.innerHTML = '';
      phases.forEach((p, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input type="text" name="name" value="${p.name}" aria-label="Name der Phase ${i+1}"></td>
          <td><input type="number" name="duration" min="1" value="${p.duration}" aria-label="Dauer der Phase ${i+1} in Sekunden"></td>
          <td><input type="text" name="desc" value="${p.desc}" aria-label="Beschreibung der Phase ${i+1}"></td>
        `;
        intervalTableBody.appendChild(tr);
      });
      editBtn.textContent = 'Speichern';
      editMode = true;
    }
  }

  startBtn.addEventListener('click', startTimer);
  resetBtn.addEventListener('click', resetTimer);
  editBtn.addEventListener('click', () => {
    if(isRunning) {
      alert('Bitte stoppen Sie den Timer, bevor Sie bearbeiten.');
      return;
    }
    toggleEdit();
  });

  // Initial display
  updateDisplay();

</script>
</body>
</html>
